
<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JioTv- Servertvhub</title>
  <link rel="icon" href="https://www.jiotv.com/favicon.ico" />
  <style>
    body {
      margin: 0;
      font-family: 'Helvetica Neue', Arial, sans-serif;
      background-color: #000000;
      overflow: hidden;
    }

    .jwplayer {
      position: absolute !important;
    }

    .jwplayer.jw-flag-aspect-mode {
      min-height: 100%;
      max-height: 100%;
    }

    #message {
      color: #fff;
      align-items: center;
      z-index: 1001;
      display: flex;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.85);
      justify-content: center;
      font-size: 22px;
      text-align: center;
      padding: 2rem;
    }
  </style>
</head>
<body>

<div id="player"></div>

<script src="https://cdn.jwplayer.com/libraries/SAHhwvZq.js"></script>
<script>
  // Optional: Your JW Player license key
  jwplayer.key = 'XSuP4qMl+9tK17QNb+4+th2Pm9AWgMO/cYH8CI0HGGr7bdjo';

  function getParam(name) {
    const url = new URL(window.location.href);
    return url.searchParams.get(name);
  }

  // Extract URL, Token, DRM, and TV Mode parameter
  let streamUrl = decodeURIComponent(getParam('url') || '');
  let token = getParam('token') || '';
  let drm = getParam('drm') || ''; // Format: KID:KEY
  const isTvMode = getParam('tv') !== null;
  
  // START CHANGE: Check if the URL is an M3U8 file
  const isM3u8Stream = streamUrl.toLowerCase().endsWith('.m3u8');
  // END CHANGE

  // Token append - MODIFIED to skip for M3U8 files
  if (streamUrl && token && !streamUrl.includes('__hdnea__') && !isM3u8Stream) {
    streamUrl += (streamUrl.includes('?') ? '&' : '?') + token;
  }

  // Parse ClearKey DRM
  let drmConfig = {};
  if (drm.includes(':')) {
    const [kid, key] = drm.split(':');
    drmConfig = {
      clearkey: {
        keyId: kid.trim().toLowerCase(),
        key: key.trim().toLowerCase(),
        robustness: {
          video: "SW_SECURE_DECODE",
          audio: "SW_SECURE_DECODE"
        }
      }
    };
  }

  // Patch XMLHttpRequest - MODIFIED to skip for M3U8 files
  (function() {
    const origOpen = XMLHttpRequest.prototype.open;
    XMLHttpRequest.prototype.open = function(method, url) {
      // Only append token if it exists AND this is not an M3U8 stream
      if (url && !url.includes('__hdnea__') && token && !isM3u8Stream) {
        url += (url.includes('?') ? '&' : '?') + token;
      }
      // The 'arguments' object is not a true array, so we pass it this way
      return origOpen.apply(this, arguments);
    };
  })();

  // Error Message Helper
  function showMessage(text) {
    const msg = document.createElement('div');
    msg.id = "message";
    msg.innerText = text;
    document.body.appendChild(msg);
  }

  // Initialize JW Player
  if (!streamUrl) {
    showMessage("‚ùå Missing or invalid stream URL.");
  } else {
    const player = jwplayer("player").setup({
      playlist: [{
        title: "Live TV",
        image: "#",
        file: streamUrl,
        drm: drmConfig
      }],
      width: "100%",
      height: "100%",
      autostart: true,
      mute: false,
      primary: "html5",
      hlshtml: true,
      aspectratio: "16:9",
      stretching: "uniform",
      playbackRateControls: true,
      controls: true,
      cast: {},
      logo: {
        file: "https://upload.wikimedia.org/wikipedia/commons/1/11/Jio_Logo.png",
        position: "top-right"
      }
    });
    
    // TV Remote Control Logic
    if (isTvMode) {
      console.log("üì∫ TV Remote Control Mode Enabled.");

      const handleRemoteControl = (event) => {
        switch (event.key) {
          // Play/Pause Control
          case 'Enter':
          case 'MediaPlayPause':
          case ' ':
            if (player.getState() === 'playing') {
              player.pause();
            } else {
              player.play();
            }
            event.preventDefault();
            break;
          
          case 'MediaPlay':
            player.play();
            event.preventDefault();
            break;
          
          case 'MediaPause':
            player.pause();
            event.preventDefault();
            break;

          // Volume Control
          case 'ArrowUp':
          case 'AudioVolumeUp':
            const newVolUp = Math.min(player.getVolume() + 5, 100);
            player.setVolume(newVolUp);
            event.preventDefault();
            break;

          case 'ArrowDown':
          case 'AudioVolumeDown':
            const newVolDown = Math.max(player.getVolume() - 5, 0);
            player.setVolume(newVolDown);
            event.preventDefault();
            break;
          
          // Mute Control
          case 'AudioVolumeMute':
          case 'm':
            player.setMute(!player.getMute());
            event.preventDefault();
            break;
        }
      };

      window.addEventListener('keydown', handleRemoteControl);
    }

    player.on("error", e => {
      console.error("Player error:", e);
      showMessage("‚ö†Ô∏è Playback Error: " + (e.message || "Unknown error"));
    });
  }
</script>

</body>
</html>
